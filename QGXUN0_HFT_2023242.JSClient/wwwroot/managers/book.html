<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Book Manager</title>
    <link rel="stylesheet" href="managerstyle.css" />
</head>
<body>

    <header>
        <h1>Book Manager</h1>
    </header>

    <main>

        <form id="book_create_form" action="javascript:;" onsubmit="createAction(this)">
            <label for="create_title">Title</label>
            <input name="Title" id="create_title" type="text" placeholder="e.g. The Green Mile" required />

            <label for="create_year">Year</label>
            <input name="Year" id="create_year" type="number" placeholder="e.g. 2008" required />

            <label for="create_publisher_box">Publisher</label>
            <select name="PublisherID" class="nullable" id="create_publisher_box" form="book_create_form"></select>

            <label for="create_price">Price</label>
            <input name="Price" class="nullable" id="create_price" type="number" step="0.01" placeholder="e.g. 9.99" />

            <label for="create_rating">Rating</label>
            <input name="Rating" class="nullable" id="create_rating" type="number" step="0.1" placeholder="e.g. 4.8" />


            <input class="send" type="submit" value="Send" />
        </form>



        <form id="book_read_selector" action="javascript:;" onsubmit="readSelected(this)">
            <label for="book_read_select">Select a book to read</label>
            <select name="Books" id="book_read_select" form="book_read_selector" size="25"></select>

            <input class="send" type="submit" value="Send" />
        </form>


        <form id="book_read_form">
            <label for="read_authors">Authors</label>
            <textarea name="Authors" id="read_authors" rows="3" readonly></textarea>

            <label for="read_title">Title</label>
            <input name="Title" id="read_title" type="text" readonly />

            <label for="read_year">Year</label>
            <input name="Year" id="read_year" type="number" readonly />

            <label for="read_publisher_box">Publisher</label>
            <input name="Publisher" id="read_publisher" type="text" readonly />

            <label for="read_price">Price</label>
            <input name="Price" class="nullable" id="read_price" type="number" readonly />

            <label for="read_rating">Rating</label>
            <input name="Rating" class="nullable" id="read_rating" type="number" readonly />
        </form>



        <form id="book_update_selector" action="javascript:;" onsubmit="updateSelected(this)">
            <label for="book_update_select">Select a book to update</label>
            <select name="Books" id="book_update_select" form="book_update_selector" size="25"></select>

            <input class="send" type="submit" value="Send" />
        </form>


        <form id="book_update_form" action="javascript:;" onsubmit="updateAction(this)">
            <label for="update_title">Title</label>
            <input name="Title" id="update_title" type="text" placeholder="e.g. The Green Mile" required />

            <label for="update_year">Year</label>
            <input name="Year" id="update_year" type="number" placeholder="e.g. 2008" required />

            <label for="update_publisher_box">Publisher</label>
            <select name="PublisherID" class="nullable" id="update_publisher_box" form="book_update_form"></select>

            <label for="update_price">Price</label>
            <input name="Price" class="nullable" id="update_price" type="number" step="0.01" placeholder="e.g. 9.99" />

            <label for="update_rating">Rating</label>
            <input name="Rating" class="nullable" id="update_rating" type="number" step="0.1" placeholder="e.g. 4.8" />


            <input class="send" type="submit" value="Send" />
        </form>



        <form id="book_delete_selector" action="javascript:;" onsubmit="deleteSelected(this)">
            <label for="book_delete_select">Select a book to remove</label>
            <select name="Books" id="book_delete_select" form="book_delete_selector" size="25"></select>

            <input class="send" type="submit" value="Send" />
        </form>



        <form id="book_readall_form">
            <label for="books_list">Books</label>
            <textarea name="Books" id="books_list" rows="50" cols="150" readonly></textarea>
        </form>

    </main>

    <aside>
        <button onclick="createInit()">Create</button>
        <button onclick="readInit()">Read</button>
        <button onclick="updateInit()">Update</button>
        <button onclick="deleteInit()">Delete</button>
        <button onclick="readAllInit()">Read All</button>
    </aside>

    <script src="webscript.js"></script>
    <script>
        itemformat = (item) => {
            return {
                "Authors": item.Authors != undefined
                    ? item.Authors.map(a => a.AuthorName).join("\n")
                    : item.authors != undefined
                        ? item.authors.map(a => a.AuthorName).join("\n")
                        : "",
                "Title": item.Title,
                "Year": item.Year,
                "Publisher": item.Publisher != undefined && item.Publisher != null
                    ? item.Publisher.PublisherName
                    : item.publisher != undefined && item.publisher != null
                        ? item.publisher.PublisherName
                        : "",
                "Price": item.Price != null
                    ? item.Price.toFixed(2)
                    : "",
                "Rating": item.Rating != null
                    ? item.Rating.toFixed(1)
                    : "",
            }
        }

        setup("Book", "BookID", "Title", itemformat)
    </script>
    <script>
        function customCreateInit() {
            document.getElementById('create_publisher_box').innerHTML = `<option selected hidden value=""></option>`;

            fetch(url + 'Publisher', HTTPRequestFormat('GET'))
                .then(response => response.json())
                .then(response => response.forEach(
                    item => document.getElementById('create_publisher_box').innerHTML += `<option value="${item.PublisherID}">${item.PublisherName}</option>`
                ))
        }
        function customUpdateInit() {
            document.getElementById('update_publisher_box').innerHTML = `<option selected hidden value=""></option>`;

            fetch(url + 'Publisher', HTTPRequestFormat('GET'))
                .then(response => response.json())
                .then(response => response.forEach(
                    item => document.getElementById('update_publisher_box').innerHTML += `<option value="${item.PublisherID}">${item.PublisherName}</option>`
                ))
        }
    </script>

</body>
</html>